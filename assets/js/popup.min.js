function load_jenis_batal(){$.ajax({url:base_url+"pembayaran/jenis_pembayaran",type:"GET",dataType:"json",beforeSend:function(){$("#id_byrbatal").append("<option value='loading'>loading</option>"),$("#id_byrbatal").empty()},success:function(a){$("#id_byrbatal option[value='loading']").remove(),$("#id_byrbatal").append("<option value=''>Pilih</option>");for(var e=a.length,t=0;t<e;t++){var n=a[t].id,d=a[t].name;$("#id_byrbatal").append("<option value='"+n+"'>"+d+"</option>")}}})}function load_jenis_lembaga(a,e){$(".tampil_lembaga").hide(),$.ajax({url:base_url+"konsumen/jenis_lembaga",type:"POST",dataType:"json",beforeSend:function(){$("#jenis_lembaga_"+a).append("<option value='loading'>loading</option>"),$("#jenis_lembaga_"+a).empty()},success:function(t){$("#jenis_lembaga_"+a).append("<option value=''>Pilih</option>");for(var n=t.length,d=0;d<n;d++){var i=t[d].id,r=t[d].name;i==e?$("#jenis_lembaga_"+a).append("<option value='"+i+"' selected>"+r+"</option>"):$("#jenis_lembaga_"+a).append("<option value='"+i+"'>"+r+"</option>")}},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}})}function load_jenis_member(a,e){$.ajax({url:base_url+"konsumen/jenis_member",type:"POST",data:{status:a},dataType:"json",beforeSend:function(){$("#jenis_member_"+a).append("<option value='loading'>loading</option>"),$("#jenis_member_"+a).empty()},success:function(t){$("#jenis_member_"+a).append("<option value=''>Pilih</option>");for(var n=t.length,d=0;d<n;d++){var i=t[d].id,r=t[d].name;i==e?$("#jenis_member_"+a).append("<option value='"+i+"' selected>"+r+"</option>"):$("#jenis_member_"+a).append("<option value='"+i+"'>"+r+"</option>")}},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}})}var isTimeout,isLoaded;function success(){isTimeout||($("#loading").hide(),$("iframe").show(),isLoaded=!0)}function searchFilterKonsumen(a){a=a||0;var e=$("#keywords").val(),t=$("#sortBy").val(),n=$("#limits").val(),d=base_url+"konsumen/ajaxKonsumen/"+a;$.ajax({type:"POST",url:d,data:{page:a,keywords:e,sortBy:t,limits:n},beforeSend:function(){$("body").loading()},success:function(a){$("#dataListKonsumen").html(a),$("body").loading("stop")},error:function(a,e,t){var n=a.responseText;sweet("Server!!!",n,"error","danger"),$("body").loading("stop")}})}function resetForm(){$("#dispu").html(""),$("#telepon_add").focus(),$("#form-tambah").trigger("reset"),$("#panggilan_add,#nama_add,#telepon_add,#alamat_add,#perusahaan_add,#jenis_lembaga_add,#alamat_perusahaan_add,#no_telp_add,#tampil_data,#via_add,#save-cari,#status_add,#max_u_add").prop("disabled",!1)}$("#sumber_kas_batal").attr("disabled",!0),$("#rekening_bayar").attr("disabled",!0),$("#saldo_kas_batal").val("Rp.0"),$("#id_byrbatal").filter((function(){$("select[data-source]").each((function(){var a=$(this);a.append('<option value="0">Pilih</option>'),$.ajax({url:a.attr("data-source")}).then((function(e){e.map((function(e){var t=$("<option>");t.val(e[a.attr("data-valueKey")]).text(e[a.attr("data-displayKey")]),a.append(t)}))}))}))})),$("#id_byrbatal").change((function(){var a=$("#id_byrbatal").val();$("#sumber_kas_batal").attr("disabled",!1),$(".rekening").attr("disabled",!0),$("#rekening_bayar").empty(),2==a?($("#rekening_bayar").attr("required",!0),$.ajax({url:base_url+"pembayaran/get_rekening",type:"post",data:{type:"cari"},dataType:"json",success:function(a){var e=a.length;$(".rekening").attr("disabled",!1),$("#rekening_bayar").append("<option value=''>Pilih rekening</option>");for(var t=0;t<e;t++){var n=a[t].id,d=a[t].name;$("#rekening_bayar").append("<option value='"+n+"'>"+d+"</option>")}},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}})):1==a?$("#rekening_bayar").append("<option value=''>Pilih rekening</option>"):$("#rekening_bayar").attr("required",!1)})),$("#id_byrbatal").change((function(){var a=$("#id_byrbatal").val();$(".sumber_kas_batal").attr("disabled",!0),$(".jatuh_tempo").attr("disabled",!0),$("#sumber_kas_batal").empty(),$.ajax({url:base_url+"pengeluaran/jenis_kas",type:"post",data:{id:a,type:"cari"},dataType:"json",success:function(a){var e=a.length;$(".sumber_kas_batal").attr("disabled",!1),$("#sumber_kas_batal").append("<option value=''>Pilih</option>");for(var t=0;t<e;t++){var n=a[t].id,d=a[t].name;$("#sumber_kas_batal").append("<option value='"+n+"'>"+d+"</option>")}},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}}),3==a&&$(".jatuh_tempo").attr("disabled",!1)})),$("#jenis_lembaga_edit").change((function(){$("#jenis_lembaga_edit").val()>1?($(".tampil_lembaga").show(),$("#nama_perusahaan_edit").attr("required",!1),$("#alamat_perusahaan_edit").attr("required",!1),$("#no_telp_edit").attr("required",!1)):($(".tampil_lembaga").hide(),$("#nama_perusahaan_edit").attr("required",!1),$("#alamat_perusahaan_edit").attr("required",!1),$("#no_telp_edit").attr("required",!1))})),$("#jenis_lembaga_add").change((function(){$("#jenis_lembaga_add").val()>1?($(".tampil_add").show(),$("#perusahaan_add").attr("required",!0),$("#alamat_perusahaan_add").attr("required",!0),$("#no_telp_add").attr("required",!0),$("#perusahaan_add").attr("data-mfindex",6),$("#alamat_perusahaan_add").attr("data-mfindex",7),$("#no_telp_add").attr("data-mfindex",8),$("#tampil_data").attr("data-mfindex",9),$("#via_add").attr("data-mfindex",10),$("#status_add").attr("data-mfindex",11),$("#max_u_add").attr("data-mfindex",11)):($(".tampil_add").hide(),$("#perusahaan_add").attr("required",!1),$("#alamat_perusahaan_add").attr("required",!1),$("#no_telp_add").attr("required",!1),$("#perusahaan_add").attr("data-mfindex",""),$("#alamat_perusahaan_add").attr("data-mfindex",""),$("#no_telp_add").attr("data-mfindex",""),$("#tampil_data").attr("data-mfindex",""),$("#via_add").attr("data-mfindex",6),$("#status_add").attr("data-mfindex",7),$("#max_u_add").attr("data-mfindex",8))})),$("#rekening_bayar").change((function(){$("#sumber_kas_batal").change()})),$("#sumber_kas_batal").change((function(){var a=$("#id_byrbatal").val(),e=$("#rekening_bayar").val(),t=$("#sumber_kas_batal").val();$.ajax({url:base_url+"kas/kas_batal",data:{id_via:a,id_rek:e,id:t},dataType:"json",method:"post",success:function(a){$("#saldo_kas_batal").val(formatMoney(a,0,"Rp."))},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}})})),$("#telepon_add").keyup((function(a){var e=$("#telepon_add").val();tlpstart=e.trim(),$("#telepon_add").val(tlpstart)})),$(document).on("click",".tambah2",(function(){var a=$(this).attr("data-id");$(".tampil_add").hide(),load_jenis_lembaga("add",1),load_jenis_member("add",1),0==a&&($("#nama_add").val(""),$("#panggilan_add").val(""),$("#telepon_add").val(""),$("#alamat_add").val(""),$("#perusahaan_add").val(""),$("#alamat_perusahaan_add").val(""),$("#no_telp_add").val(""),$("#status_add").val("0"),$("#max_u_add").val("0"),$("#via_add").val("build"),$("#type_add").val("add_on_pelanggan")),$("#modal-tambah-1").modal({backdrop:"static",keyboard:!1}),setTimeout((function(){$("#telepon_add").focus()}),1e3)})),setTimeout((function(){isLoaded||($("#loading").hide(),$("iframe").hide(),$("#error").show(),$("#error").css("display","flex"),isTimeout=!0)}),1e5),$("#telepon_add").change((function(){var a=$("#idnya").val();a=a||0;var e=$("#telepon_add").val(),t=$("#type_add").val();if(!(e.length<=9))return $.ajax({url:base_url+"konsumen/cek_telp",data:{telp:e,type_add:t},type:"POST",dataType:"json",success:function(t){"ada"==t[0]?(a>0?$("#dispu").html("<a href='#' class='btn btn-info btn-sm cariada' data-toggle='tooltip' data-placement='left' title='Pilih' data-idkon='"+t.idnya+"' data-idin='"+a+"' data-idTelp='"+e+"'><i class='fa fa-user-plus'></i></a><a href='#' class='btn btn-danger btn-sm clearada' data-toggle='tooltip' data-placement='left' title='Clear' onclick='resetForm()'><i class='fa fa-user-times'></i></a>"):$("#dispu").html("<a href='#' class='btn btn-danger btn-sm clearada' data-toggle='tooltip' data-placement='left' title='Clear' onclick='resetForm()'><i class='fa fa-user-times'></i></a>"),$("#panggilan_add,#nama_add,#telepon_add,#alamat_add,#perusahaan_add,#jenis_lembaga_add,#jenis_member_add,#alamat_perusahaan_add,#no_telp_add,#tampil_data,#via_add,#save-cari,#status_add,#max_u_add").prop("disabled",!0),t.jenis>1?$(".tampil_add").show():$(".tampil_add").hide(),$("#jenis_lembaga_add").val(t.jenis),$("#jenis_member_add").val(t.jenis_member),$("#panggilan_add").val(t.panggilan),$("#nama_add").val(t.nama),$("#alamat_add").val(t.alamat),$("#perusahaan_add").val(t.perusahaan),$("#alamat_perusahaan_add").val(t.alamat),$("#no_telp_add").val(t.perusahaan),$("#via_add").val(t.reff),$("#errore").hide()):400==t.status?(sweet("Peringatan!!!",t.msg,"warning","warning"),$("#dispu").hide(),$("#telepon_add").val("")):"notelp"==t[0]?$("#errore").fadeIn(1e3,(function(){$("#errore").html('<div class="alert alert-warning"> <span class="glyphicon glyphicon-info-sign"></span>No. telp harus berawalan 08/628/+628</div>')})):($("#telepon_add").val(t.msg),$("#dispu").html("<button type='button' class='btn btn-success btn-sm takada' data-toggle='tooltip' data-placement='left' title='No. belum ada'><i class='fa fa-user'></i></button>"),$("#panggilan_add,#nama_add,#telepon_add,#alamat_add,#perusahaan_add,#jenis_lembaga_add,#jenis_member_add,#alamat_perusahaan_add,#no_telp_add,#via,#save-cari,#status_add,#max_u_add").prop("disabled",!1),$("#errore").hide())},error:function(a,e,t){sweet("Peringatan!!!",t,"warning","warning")}}),!1;$("#dispu").html("<img src='"+base_url+"assets/img/ajax-loader.gif' data-toggle='tooltip' title='cek data'/>")})),$(document).on("click",".edit_konsumen",(function(a){a.preventDefault();var e=$(this).attr("data-id"),t=$(this).attr("data-jenis"),n=$(this).attr("data-member");load_jenis_lembaga("edit",t),load_jenis_member("edit",n),$.ajax({url:base_url+"konsumen/cek_konsumen",data:{id:e},method:"POST",dataType:"json",beforeSend:function(){$("body").loading({zIndex:1070})},success:function(a){200==a.status?("admin"!=level&&$(".update_data").attr("disabled",!0),a.jenis>1?$(".tampil_lembaga").show():$(".tampil_lembaga").hide(),$("#modal-edit-konsumen").modal("show"),$("#error_piutang").css("display","none"),$("#id_edit").val(a.id),$("#panggilan_edit").val(a.panggilan),$("#telepon_edit").val(a.nohp),$("#nama_edit").val(a.nama),$("#alamat_edit").val(a.alamat1),$("#jenis_lembaga_edit").val(a.jenis),$("#nama_perusahaan_edit").val(a.perusahaan),$("#alamat_perusahaan_edit").val(a.alamat2),$("#no_telp_edit").val(a.no_telp),$("#via_edit").val(a.via),$("#tampil_edit").val(a.tampil),$("#status_edit").val(a.boleh),$("#max_u").val(a.max),$("body").loading("stop")):401==a.status&&(sweet("Login Status!!!",a.msg,"error","danger"),$("body").loading("stop"))},error:function(a,e,t){var n=a.responseText;sweet("Server!!!",n,"error","danger"),$("body").loading("stop")}})})),$("#status_add").change((function(){1==$("#status_add").val()?($("#max_u_add").prop("readonly",!0),$("#max_u_add").val(0)):$("#max_u_add").prop("readonly",!1)})),$("#status").change((function(){1==$("#status").val()?$("#max_u").prop("readonly",!0):$("#max_u").prop("readonly",!1)})),$(document).on("click",".batal_order",(function(a){a.preventDefault();var e=$(this).attr("data-id"),t=$(this).data("modedit");$.ajax({url:base_url+"main/cek_order",data:{id:e},method:"POST",dataType:"json",success:function(a){$("#no_order").val(""),$("#keterangan").val(""),"ok"==a.status?($("#modal-batal").modal("show"),$("#no_order").val(a.id),$("#notrx").val(a.notrx),$("#keterangan").val(a.ket),$("#mod_batal").val(t),$("#total_batal").val(formatMoney(a.total,0,"Rp.")),load_jenis_batal()):sweet("Status!!!",a.msg,"warning","warning")},error:function(a,e,t){var n=a.responseText;sweet("Server!!!",n,"error","danger")}})})),$("#OpenCart-1").on("hide.bs.modal",(function(){$("#print,#bayarin,#simpan").prop("disabled",!1),$("#namanya").html(""),hideCart(),searchFilter(),$.LoadingOverlay("hide")})),$("#print-4").on("hide.bs.modal",(function(){searchFilter(),$.LoadingOverlay("hide")})),$("body").on("hidden.bs.modal",".modal",(function(){$(this).removeData("bs.modal"),$(this).find("form").trigger("reset"),$.LoadingOverlay("hide")})),$("#modal-batal").on("hidden.bs.modal",(function(a){a.preventDefault(),$(this).find("input,textarea,select").val("").end().find("input[type=checkbox], input[type=radio]").prop("checked","").end()})),$("#form-batal").submit((function(a){a.preventDefault();var e=angka($("#total_batal").val()),t=angka($("#saldo_kas_batal").val());$("#sumber_kas_batal").val();if(parseInt(t)<parseInt(e))sweet("Peringatan!!!","Saldo tidak mencukupi","warning","warning");else{var n=$("#form-batal").serialize();$.ajax({url:base_url+"main/simpan_batal",type:"post",data:n,dataType:"json",beforeSend:function(){$("body").loading({zIndex:1070})},success:function(a){$("body").loading("stop"),"ok"==a.ok?sweet("Update!!!",a.msg,"success","success"):sweet("Peringatan!!!",a.msg,"warning","warning"),searchFilter(),$("#modal-batal").modal("hide"),$("#OpenCart-1").modal("hide")},error:function(a,e,t){var n=a.responseText;$("body").loading("stop"),sweet("Server!!!",n,"error","danger"),$("#modal-batal").modal("hide"),$("#OpenCart-1").modal("hide")}})}})),$("#form-edit-k").submit((function(a){a.preventDefault();var e=$("#form-edit-k").serialize();$.ajax({url:base_url+"konsumen/update_konsumen",type:"post",data:e,dataType:"json",beforeSend:function(){$("body").loading()},success:function(a){200==a.status?(sweet("Update!!!",a.msg,"success","arr.ok"),searchFilterKonsumen()):sweet("Peringatan!!!",a.msg,"warning","warning"),$("#modal-edit-konsumen").modal("hide"),$("body").loading("stop")},error:function(a,e,t){var n=a.responseText;sweet("Server!!!",n,"error","danger"),$("#modal-edit-konsumen").modal("hide"),$("body").loading("stop")}})}));